<div class="row g-4 page-background">
<div class="row g-4">
  <div class="d-flex justify-content-between">
      <div class="col-md-6 quest-background">
        <div class="card h-100 p-3 mt-4 guild-board">
          <div class="card-header quest-container">
            <h4 class="mt-4 quest-header">Daily Quests</h4>
            <div class="card-body">
              <% if @daily_quests.any? %>
                <% @daily_quests.each do |quest| %>
                  <div class="mb-0">
                    <!-- Quest Title & Time -->
                    <div class="d-flex justify-content-between quest-details">
                      <h5 class="quest-body"><%= quest.title %></h5>
                      <div data-controller="date-edit" data-quest-id="<%= quest.id %>">
                        <div
                            class="d-flex justify-content-between gap-2">
                          <h5 class="quest-body" data-date-edit-target="display" data-action="click->date-edit#showInput"><%= quest.time.strftime("%H:%M") %></h5>
                          <h5 data-date-edit-target="text"></h5>
                        </div>

                        <div data-date-edit-target="input" style="display: none;">
                          <%= form_with model: quest, url: quest_path(quest), method: :patch, local: true do |f| %>
                            <%= f.time_field :time, value: quest.time.strftime("%H:%M"),
                                            class: "btn btn-sm btn-outline-primary",
                                            data: { action: "keydown->date-edit#checkEnter" } %>
                          <% end %>
                        </div>
                      </div>
                    </div>

                    <!-- Quest Description & Complete Button -->
                    <div class="quest-box d-flex justify-content-between">
                      <span><%= quest.description %></span>

                      <div data-controller="complete" class="quest-desc-box">
                        <% if quest.completed? %>
                          <%= button_to "Completed", "#", disabled: true, class: "link-button text-completed", data: { complete_target: "button" } %>
                        <% else %>
                          <%= button_to "Complete", quest_path(quest),
                                method: :patch,
                                class: "link-button text-active",
                                data: { complete_target: "button", action: "click->complete#markCompleted" } %>
                        <% end %>

                        <!-- Modal Inside the same Controller div-->
                        <div class="modal fade" id="questModal-<%= quest.id %>" tabindex="-1" aria-hidden="true" data-complete-target="popup">
                          <div class="modal-dialog">
                            <div class="modal-content" style="border-radius: 20px; background-color: #fff3e0; border: 2px solid #000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                              <div class="modal-header justify-content-center" style="border-bottom: 2px solid #000; background-color: rgba(255, 193, 7, 0.25);">
                                <h5 class="modal-title fw-bold" style="font-family: 'Press Start 2P', cursive; font-size: 1rem;">Quest Completed!</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(0);"></button>
                              </div>

                              <div class="modal-body" style="font-family: 'Press Start 2P', cursive; font-size: 0.85rem; text-align: center;">
                                The Guild <%= image_tag "guild.png", style: "width: 24px; height: 24px; vertical-align: middle; image-rendering: pixelated;" %>
                                awards you <%= quest.xp_reward %> <%= image_tag "xp.png", style: "width: 24px; height: 24px; vertical-align: middle; image-rendering: pixelated;" %>
                                and <%= quest.coin_reward %> <%= image_tag "coins.png", style: "width: 24px; height: 24px; vertical-align: middle; image-rendering: pixelated;" %>!
                              </div>

                              <div class="text-center mb-2 d-flex flex-column align-items-center">
                                <% if quest.item_reward %>
                                  <%= Item.find_by(id: quest.item_reward).name %>
                                  <%= image_tag Item.find_by(id: quest.item_reward).img,
                                      style: "width: 80px; height: 80px; image-rendering: pixelated; border: 2px solid #000; border-radius: 12px; object-fit: contain; margin: 2px 0;"
                                  %>
                                  <%= Item.find_by(id: quest.item_reward).rarity %>
                                <% end %>
                              </div>

                              <div class="modal-footer" style="border-top: 2px solid #000; justify-content: center;">
                                <button type="button" class="btn btn-secondary fw-bold" data-bs-dismiss="modal"
                                        style="border-radius: 20px; background-color: #c68642; color: #fff; border: 2px solid #8B5A2B; font-family: 'Press Start 2P', cursive;">
                                  Close
                                </button>
                              </div>

                            </div>
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p>No daily quests yet, pick up some at the Guild!!</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>


      <div class="col-md-6 quest-background">
        <div class="card h-100 p-3 mt-4 guild-board">
          <div class="card-header quest-container">
            <h4 class="mt-4 quest-header">Daily Quests</h4>
            <div class="card-body">
              <% if @daily_quests.any? %>
                <% @daily_quests.each do |quest| %>
                  <div class="mb-0">

                    <!-- Quest Title & Time -->
                    <div class="d-flex justify-content-between quest-details">
                      <h5 class="quest-body"><%= quest.title %></h5>
                      <div data-controller="date-edit">
                        <div data-date-edit-target="display"
                            data-action="click->date-edit#showInput"
                            class="d-flex justify-content-between gap-2">
                          <h5 class="quest-body"><%= quest.time.strftime("%H:%M") %></h5>
                          <h5 data-date-edit-target="text"></h5>
                        </div>

                        <div data-date-edit-target="input" style="display: none;">
                          <%= form_with model: quest, url: quest_path(quest), method: :patch, local: true do |f| %>
                            <%= f.time_field :time, value: quest.time.strftime("%H:%M"),
                                            class: "btn btn-sm btn-outline-primary",
                                            data: { action: "keydown->date-edit#checkEnter" } %>
                          <% end %>
                        </div>
                      </div>
                    </div>

                    <!-- Quest Description & Complete Button -->
                    <div class="quest-box d-flex justify-content-between">
                      <span><%= quest.description %></span>

                      <div data-controller="complete" class="quest-desc-box">
                        <% if quest.completed? %>
                          <%= button_to "Completed", "#", disabled: true, class: "link-button text-completed", data: { complete_target: "button" } %>
                        <% else %>
                          <%= button_to "Complete", quest_path(quest),
                                method: :patch,
                                params: { quest: { completed: true } },
                                class: "link-button text-active",
                                data: { complete_target: "button", action: "click->complete#markCompleted" } %>
                        <% end %>

                    <!-- Modal Inside the same Controller div-->
                        <div class="modal fade" id="questModal-<%= quest.id %>" tabindex="-1" aria-hidden="true" data-complete-target="popup">
                          <div class="modal-dialog">
                            <div class="modal-content" style="border-radius: 20px; background-color: #fff3e0; border: 2px solid #000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">

                              <div class="modal-header justify-content-center" style="border-bottom: 2px solid #000; background-color: rgba(255, 193, 7, 0.25);">
                                <h5 class="modal-title fw-bold" style="font-family: 'Press Start 2P', cursive; font-size: 1rem;">Quest Completed!</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(0);"></button>
                              </div>

                              <div class="modal-body" style="font-family: 'Press Start 2P', cursive; font-size: 0.85rem; text-align: center;">
                                The Guild <%= image_tag "guild.png", style: "width: 24px; height: 24px; vertical-align: middle; image-rendering: pixelated;" %>
                                awards you <%= quest.xp_reward %> <%= image_tag "xp.png", style: "width: 24px; height: 24px; vertical-align: middle; image-rendering: pixelated;" %>
                                and <%= quest.coin_reward %> <%= image_tag "coins.png", style: "width: 24px; height: 24px; vertical-align: middle; image-rendering: pixelated;" %>!
                              </div>

                              <div class="text-center mb-2 d-flex flex-column align-items-center">
                                <% if quest.item_reward %>
                                  <%= Item.find_by(id: quest.item_reward).name %>
                                  <%= image_tag Item.find_by(id: quest.item_reward).img,
                                      style: "width: 80px; height: 80px; image-rendering: pixelated; border: 2px solid #000; border-radius: 12px; object-fit: contain; margin: 2px 0;"
                                  %>
                                  <%= Item.find_by(id: quest.item_reward).rarity %>
                                <% end %>
                              </div>

                              <div class="modal-footer" style="border-top: 2px solid #000; justify-content: center;">
                                <button type="button" class="btn btn-secondary fw-bold" data-bs-dismiss="modal"
                                        style="border-radius: 20px; background-color: #c68642; color: #fff; border: 2px solid #8B5A2B; font-family: 'Press Start 2P', cursive;">
                                  Close
                                </button>
                              </div>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                <% end %>
              <% else %>
                <p>No daily quests yet, pick up some at the Guild!!</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



<%= audio_tag "fanfare.mp3", id: "complete-audio" %>
