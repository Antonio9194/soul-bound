<div class="row justify-content-center g-2">
  <div class="col-md-6 col-lg-5"> <!-- Smaller column -->
    <div class="card h-100 p-3 mt-3 shadow rounded-4 border border-2 border-warning" style="background: #fff3e0; color: black;">

      <div class="card-header text-center bg-light rounded-3 mb-3" style="border: 1px solid #000;">
        <h1 class="fw-bold" style="font-family: 'Press Start 2P', cursive; font-size: 1.2rem;"><%= @character.name %></h1>
      </div>

      <div class="d-flex flex-column justify-content-center align-items-center"
           style="border: 2px solid #000; border-radius: 20px; padding: 15px; background-color: #f9f1e7; position: relative;">

        <!-- Character Preview -->
        <div class="card position-relative mb-3" style="width: 300px; height: 260px; background: transparent; border: none;">
          <div id="character-preview"
               style="width: 80px; height: 120px; border: 1px solid gray; border-radius: 5px; background-color: #eaeaea; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); image-rendering: pixelated;">
          </div>

          <!-- Gear Slots -->
          <div id="slot-head" style="position: absolute; bottom: 180px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; border: 1px solid gray; border-radius: 5px"></div>
          <div id="slot-weapon" style="position: absolute; bottom: 120px; right: -40px; width: 60px; height: 60px; border: 1px solid gray; border-radius: 5px"></div>
          <div id="slot-accessory" style="position: absolute; bottom: 120px; left: -40px; width: 60px; height: 60px; border: 1px solid gray; border-radius: 5px"></div>
          <div id="slot-body" style="position: absolute; bottom: 0; left: -40px; width: 60px; height: 60px; border: 1px solid gray; border-radius: 5px"></div>
          <div id="slot-feet" style="position: absolute; bottom: 0; right: -40px; width: 60px; height: 60px; border: 1px solid gray; border-radius: 5px"></div>
        </div>

        <!-- Stats -->
        <h5 class="fw-bold mb-2" style="font-family: 'Press Start 2P', cursive; font-size: 0.9rem;">Level: <%= @character.level %></h5>
        <div class="d-flex justify-content-between w-100" style="margin-top: 10px;">
          <h5 class="fw-bold" style="font-family: 'Press Start 2P', cursive; font-size: 0.9rem;">Exp: <%= @character.xp %></h5>
          <h5 class="fw-bold" style="font-family: 'Press Start 2P', cursive; font-size: 0.9rem;">Coins: <%= sprintf("%.3f", @character.coin / 1000.0) %> ðŸ’°</h5>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex justify-content-center mt-3 gap-2">
        <%= link_to "Edit", edit_character_path(@character),
                    class: "btn btn-outline-primary fw-bold rounded-4 flex-fill" %>
        <%= link_to "Delete", @character,
                    data: { turbo_method: :delete, turbo_confirm: 'Are you sure you want to delete this character?' },
                    class: "btn btn-outline-danger fw-bold rounded-4 flex-fill" %>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const preview = document.getElementById("character-preview");

    // Get stored character data from Rails
    const klass = "<%= @character.class_name.downcase %>";
    const gender = "<%= @character.gender.downcase %>";

    // Sprite data
    const spriteData = {
      "male_warrior": {
        path: "<%= asset_path('male_warrior.png') %>",
        frames: 5,
        frameWidth: 86,
        frameHeight: 118,
        offsetX: [0, 0, 0, 0, 0],
        speed: 170
      },
      "female_warrior": {
        path: "<%= asset_path('female_warrior.png') %>",
        frames: 9,
        frameWidth: 100,
        frameHeight: 118,
        offsetX: [0, 0, 0, 0, 0],
        speed: 170
      },
      "male_mage": {
        path: "<%= asset_path('male_mage.png') %>",
        frames: 16,
        frameWidth: 128,
        frameHeight: 138,
        offsetX: [0,0,0,0,0],
        speed: 150
      },
      "female_mage": {
        path: "<%= asset_path('female_mage.png') %>",
        frames: 10,
        frameWidth: 128,
        frameHeight: 138,
        offsetX: [0,0,0,0,0],
        speed: 120
      },
      "male_warewolf": {
        path: "<%= asset_path('male_warewolf.png') %>",
        frames: 7,
        frameWidth: 128,
        frameHeight: 138,
        offsetX: [0,0,0,0,0],
        speed: 110
      },
      "female_warewolf": {
        path: "<%= asset_path('female_warewolf.png') %>",
        frames: 11,
        frameWidth: 128,
        frameHeight: 138,
        offsetX: [0,0,0,0,0],
        speed: 110
      },
      "gorgon": {
        path: "<%= asset_path('gorgon_1.png') %>",
        frames: 16,
        frameWidth: 128,
        frameHeight: 138,
        offsetX: [0,0,0,0,0],
        speed: 160
      }
    };

    const key = klass === "gorgon" ? "gorgon" : `${gender}_${klass}`;
    const sprite = spriteData[key];

    if (!sprite) return;

    let currentFrame = 0;

    // Set up preview div
    preview.style.width = sprite.frameWidth + "px";
    preview.style.height = sprite.frameHeight + "px";
    preview.style.backgroundImage = `url(${sprite.path})`;
    preview.style.backgroundRepeat = "no-repeat";
    preview.style.backgroundPosition = "0 0";
    preview.style.imageRendering = "pixelated";

    // Animate frames
    setInterval(() => {
      const xOffset = (sprite.frameWidth * currentFrame) - (sprite.offsetX?.[currentFrame] || 0);
      preview.style.backgroundPosition = `-${xOffset}px 0px`;
      currentFrame = (currentFrame + 1) % sprite.frames;
    }, sprite.speed || 170);
  });
</script>
